# 基于Springboot的鲜果商场网站设计书

## 1. 项目概述

本项目旨在设计并实现一个基于Springboot的鲜果商场网站。该网站采用前后端分离架构，并基于开源项目RuoYi-Vue进行二次开发。系统效仿主流电商平台（如淘宝）的模式，构建一个允许多方角色参与的在线水果交易平台。主要角色包括：负责平台整体运营的**网站管理员**，在平台开设店铺、销售水果的**供货商（卖家）**，以及在网站浏览、选购水果的**客户（买家）**。

本设计书将详细阐述网站的核心功能模块、主要业务流程以及关键的数据库实体设计，重点描述系统已实现的功能，为毕业论文的“具体实现”章节提供内容支持。

## 2. 系统角色与核心职责

系统主要包含以下三类角色，各自承担不同的职责：

- **客户（买家）**：
  - 浏览全站商品，支持多种搜索、筛选及排序方式。
  - 查看商品详情，包括图片、描述、规格、价格、评价等。
  - 管理个人购物车，包括添加、删除商品，修改数量，选择结算商品。
  - 管理个人收货地址，包括增删改查及设置默认地址。
  - 提交订单，支持从购物车结算或直接购买，系统能按店铺自动拆分订单。
  - 查看和管理个人订单，包括取消订单、确认收货、评价商品、删除订单、再次购买等操作。
  - 管理个人收藏夹，包括添加、移除收藏商品。
  - 可以申请开设自己的店铺，成为卖家。
- **供货商（卖家）**：
  - 管理自己的店铺信息，包括店铺Logo、名称、描述、联系电话、运营状态等。
  - 发布和管理店铺内的商品，包括新增、编辑、删除商品，管理商品图片、规格、价格、库存、分类、标签等。
  - 可以向管理员提交新的商品分类申请。
  - 处理店铺接收到的订单，如进行发货操作。
- **网站管理员**：
  - 管理平台上的所有店铺，包括审核开店申请、封禁违规店铺、删除店铺等。
  - 管理商品分类，包括新增系统分类、编辑分类、审核商家提交的分类申请、删除分类等。
  - 管理商品标签，功能与分类管理类似。
  - （基于RuoYi-Vue框架特性）管理系统用户、角色权限、菜单、数据字典、系统参数、日志等。

## 3. 网站功能设计

### 3.1 买家视角功能

#### 3.1.1 浏览商品 (06)

- **商品列表展示**：以网格布局展示全站商品，包括主图、产品名称、归属店铺、规格、单价、评分及部分标签。
- **搜索与筛选**：支持按价格区间、标签（多选）、店铺名称（模糊）、产品名称（模糊）、分类进行搜索。
- **排序功能**：支持按规格价格、单位价格、销量、上架时间、评分进行排序。
- **商品详情查看**：点击商品可进入详情页，展示轮播图、完整的商品信息、关联标签以及该商品的评价列表（用户名称、头像、评价内容、照片、等级）。
- **分类科普信息**：可查看已审核通过的分类的科普描述。
- **收藏商品**：提供将商品加入“我的收藏”的功能。
- **分享商品**：可以生成商品URL或文本进行分享。
- **购买/加入购物车**：
  - 提供“加入购物车”和“直接购买”按钮，点击后弹出统一对话框。
  - 对话框内回显收货地址（默认显示默认地址，可展开选择或管理地址）和商品信息（主图、价格、可选数量、规格等），并提供订单备注填写处。
  - **地址管理（对话框内）**：支持选择、新增、编辑、删除收货地址，以及设置默认地址。
  - **加入购物车操作**：将商品信息及选择数量存入用户购物车。
  - **直接购买操作**：直接基于当前商品信息生成订单。
- **店铺跳转**：在商品信息中点击店铺名称，可跳转至该店铺的专属商品列表页面。

#### 3.1.2 我的购物车 (07)

- **购物车列表展示**：按用户ID查询购物车项，条状布局展示，按店铺分组。显示商品主图、名称、数量、金额，以及购物车总金额。
- **选择操作**：支持单个商品选择、店铺内商品全选、全部商品全选。选中状态持久化，并自动计算当前选中商品的总金额。
- **数量操作**：支持增减购物车中商品的数量，并进行库存校验。
- **删除操作**：支持单个商品删除、批量删除已选商品、清空购物车。
- **商品/店铺跳转**：点击商品可查看详情，点击店铺名称可进入店铺页面。
- **状态提醒**：对购物车中商品状态（如已下架、库存不足、店铺状态异常）进行提醒，异常状态商品自动取消选中。
- **加入收藏**：支持将购物车中的商品移入“我的收藏”。
- **结算操作**：点击“结算”按钮，进入订单确认界面。
  - **订单确认界面**：以小票样式展示选中商品总览（按店铺分组），回显收货地址信息（同购买对话框内地址管理），显示订单总价。
  - **订单生成**：确认后，系统按店铺拆分订单，为每个店铺生成独立的子订单。

#### 3.1.3 我的收藏 (09)

- **收藏列表展示**：根据用户ID列举收藏的商品，网格布局展示商品主图、名称、价格、规格、店铺信息、商品状态、评分、关联标签。
- **商品/店铺跳转**：点击商品可查看详情，点击店铺名称可进入店铺页面。
- **取消收藏**：支持单个或批量取消收藏的商品。
- **搜索与排序**：支持按产品名称、店铺名称搜索收藏的商品；支持按收藏时间、价格、评分排序。
- **状态提醒**：对收藏夹中商品状态（如已下架、库存不足、店铺状态异常）进行提醒。

#### 3.1.4 我的订单 (10)

- **订单列表展示**：根据用户ID查询订单列表。以订单为基本单元展示订单编码、状态、总额、备注、店铺编号、店铺名称。支持按父订单号分组展示（针对一次购物行为产生的跨店铺订单）。
  - 提供扩展按钮查看订单关联的收货地址快照和订单详情项（商品快照、数量、价格等）。
- **搜索与筛选**：支持按订单编号（模糊）搜索，按订单状态（如全部、待发货、待收货等）筛选。
- **订单操作**：根据订单状态提供不同的操作按钮：
  - **待发货**：可取消订单。
  - **待收货**：可确认收货。
  - **待评价**：可对订单中的商品进行评价（填写评价内容、选择评分等级、上传图片、选择是否匿名）。评价后订单状态更新为“已完成”。
  - **已完成/已取消**：可删除订单。对于已完成订单，还可进行“再次购买”（将订单内商品重新加入购物车）。

#### 3.1.5 我的地址簿 (08)

- **地址列表展示**：默认仅显示默认收货地址，可展开查看所有地址。
- **地址管理**：提供“管理/新增地址”功能。
  - **新增地址**：填写收货人、联系电话、性别、省市区、详细地址等信息。若用户无其他地址，则新地址自动设为默认。
  - **编辑地址**：修改已存在的地址信息。
  - **删除地址**：删除指定地址（默认地址不可直接删除，需先取消默认）。
  - **设置默认地址**：将指定地址设为默认收货地址。

#### 3.1.6 我要开店 (04)

- **开店申请**：允许尚未拥有店铺的普通用户申请开店。
  - 用户需填写店铺Logo、店铺名称、店铺描述（富文本）、联系电话等基本信息。
  - 提交申请后，店铺状态变为“待审核”，用户界面跳转至“我的店铺”雏形页面。

### 3.2 商家视角功能

#### 3.2.1 我的店铺 (05)

- **店铺信息展示**：展示店铺编号、图标、名称、描述、运营状态（如待审核、营业中、停业中、封禁中）、联系电话、申请标记、审核备注。运营状态以进度条形式展示。
- **信息修改**：支持商家修改店铺图标、名称、描述、联系电话。
- **运营状态切换**：若店铺处于“营业中”或“停业中”，商家可通过按钮便捷切换状态。
- **异常状态申诉**：若店铺处于“待审核”或“封禁中”等异常状态，商家可通过“申请”按钮提交审核或申诉，更新申请标记。

#### 3.2.2 店内商品 (06)

- **商品列表展示**：根据店铺ID查询本店商品，表格布局展示产品名称、编码、主图、价格、产品状态、库存、销量、评价等。
- **搜索与筛选**：支持按产品名称、产品编码搜索；支持按产品状态（全部、上架、下架、售罄、预警）筛选。库存低于预警值的商品会有提示样式。
- **排序功能**：支持按销量、评价、库存等条件排序。
- **查看商品详情**：可查看商品完整信息，包括其所属分类和关联的标签。
- **提交新分类**：商家可提交新的商品分类申请（名称、描述），由管理员审核。新分类来源标记为“商家”，审核状态为“待审核”。
- **新增商品**：
  - 填写商品名称、上传图片（支持多张，首张为主图，其余为轮播图）、规格数值及单位、计价单位、价格、库存、分类（从已审核通过的分类中选择）、预警值、标签（从已有标签中选择）。
  - 系统自动生成产品编号，产品状态默认为“上架”。
- **编辑商品**：可修改现有商品信息，编辑项与新增时一致。
- **删除商品**：可删除店铺内的商品。

#### 3.2.3 店内订单 (11)

- **订单列表展示**：根据店铺ID查询本店订单列表及详情。以订单为基本单元展示订单编码、状态、总额、备注。支持按父订单号分组展示。
  - 提供扩展按钮查看订单关联的收货地址快照和订单详情项。
- **搜索与筛选**：支持按订单编号（模糊）搜索，按订单状态筛选。
- **订单操作**：
  - **发货**：对“待发货”状态的订单执行发货操作，更新订单状态为“待收货”。

### 3.3 管理员视角功能

#### 3.3.1 店铺管理 (03)

- **店铺列表查询**：展示平台所有店铺的列表，包括店铺编号、图标、名称、运营状态、关联用户（创建者）、联系电话等。
- **搜索功能**：支持按店铺编号、名称、运营状态、联系电话进行搜索。
- **审核店铺申请**：
  - 管理员可查看处于“待审核”状态或“封禁中且申请标记为1”的店铺申请。
  - 可对申请进行“通过”或“拒绝”操作。
  - 若通过，店铺状态更新为“停业中”（商家可自行改为营业中），审核备注记录为“审核通过”，并为用户分配商家角色。
  - 若拒绝，需填写拒绝理由作为审核备注。
  - 处理完毕后，店铺的申请标记更新为0。
- **封禁店铺**：可对处于“营业中”或“停业中”的店铺进行封禁操作，需填写封禁理由。封禁后店铺状态更新为“封禁中”。
- **删除店铺**：可删除处于“封禁中”或“已注销”状态的店铺。

#### 3.3.2 分类管理 (02)

- **分类列表查询**：展示所有商品分类列表，包括分类名称、描述、来源（系统/商家）、审核状态、更新时间。
- **搜索与排序**：支持按分类名称、来源、审核状态搜索；支持按更新时间排序。
- **新增系统分类**：管理员可新增分类，填写名称、描述。新增的分类来源为“系统”，审核状态默认为“已通过”，审核备注为“审核通过”。
- **编辑分类**：可修改现有分类的名称和描述。
- **审核商家分类**：
  - 对商家提交的、状态为“待审核”的分类进行审核。
  - 若通过，审核状态改为“已通过”，审核备注记录为“审核通过”。
  - 若拒绝，需填写拒绝理由，审核状态改为“已拒绝”。
- **删除分类**：可删除分类，但若该分类已关联商品，则无法删除。

#### 3.3.3 标签管理 (12)

- 标签管理的功能与分类管理类似，包括标签的列表查询、新增、编辑和删除。

## 4. 数据库设计

### 4.1 核心实体与关系概述

系统数据库围绕商品、店铺、用户、订单等核心业务进行设计。主要实体包括：分类表 (`tb_category`)、产品表 (`tb_product`)、店铺表 (`tb_store`)、标签表 (`tb_tag`)、产品-标签关系表 (`tb_product_tag`)、地址表 (`tb_address`)、购物车项表 (`tb_cart_item`)、订单表 (`tb_order`)、订单详情表 (`tb_order_detail`)、文件表 (`tb_file`)、收藏表 (`tb_favorite`)、评价表 (`tb_review`) 以及日统计表 (`tb_statistics_daily`)。

所有业务数据表均包含公共字段：`create_time` (创建时间)、`update_time` (修改时间)、`create_by` (创建人)、`update_by` (修改人)。系统依赖一张 `user` 表（由RuoYi-Vue框架提供）进行用户账户管理和权限分配。

### 4.2 主要数据表设计

以下列出部分核心数据表及其关键字段和业务注意事项：

#### 4.2.1 `tb_category` (分类表)

- `category_id` (主键)
- `category_name` (品类名称, 唯一)
- `source_type` (分类来源: 系统/商家)
- `audit_status` (审核状态: 0待审核, 1已通过, 2已拒绝)
- `audit_comment` (审核备注)
- `category_desc` (科普描述, 富文本)
- **注意事项**：系统分类默认通过审核；商家提交的分类需管理员审核。

#### 4.2.2 `tb_product` (产品表)

- `product_id` (主键)
- `product_name` (产品名称)
- `product_code` (产品编号, 唯一)
- `main_img` (产品主图URL, 冗余存储)
- `specification_value` (规格数值)
- `specification_unit` (规格数值单位: g, kg, jin等)
- `price_unit` (计价单位: 盒, 个, 斤等)
- `price` (产品价格, 按计价单位)
- `unit_price` (单位价格, 动态计算, 用于统计排序)
- `stock` (库存数量)
- `stock_alert` (库存预警值)
- `total_sales` (产品销量)
- `product_status` (产品状态: 0上架, 1下架, 2售罄)
- `avg_rating` (平均评分)
- `review_count` (评价数量)
- `store_name` (店铺名称, 冗余)
- `product_desc` (产品描述, 富文本)
- `store_id` (所属店铺ID, 逻辑外键)
- `category_id` (所属分类ID, 逻辑外键)
- **注意事项**：`product_code` 全局唯一；同一店铺下 `product_name` 应具有区分度；库存为0时，产品状态应自动更新为“售罄”。

#### 4.2.3 `tb_store` (店铺表)

- `store_id` (主键)
- `store_code` (店铺编号, 唯一)
- `store_logo` (店铺图标URL, 冗余存储)
- `store_name` (店铺名称, 唯一)
- `store_desc` (店铺描述, 富文本)
- `store_status` (运营状态: 0待审核, 1营业中, 2停业中, 3封禁中, 4已注销)
- `contact` (联系电话)
- `audit_flag` (申请标记: 0未申请/已处理, 1已申请待审核)
- `audit_comment` (审核备注/封禁理由)
- `user_id` (关联的用户ID, 逻辑外键, 唯一)
- **注意事项**：`store_code` 和 `store_name` 全局唯一；一个用户只能创建一个店铺。

#### 4.2.4 `tb_tag` (标签表)

- `tag_id` (主键)
- `tag_name` (标签名称, 唯一)

#### 4.2.5 `tb_product_tag` (产品-标签关系表)

- `product_tag_id` (主键)
- `product_id` (产品ID, 逻辑外键)
- `tag_id` (标签ID, 逻辑外键)
- **注意事项**：`product_id` 和 `tag_id` 构成联合唯一约束。

#### 4.2.6 `tb_address` (地址表)

- `address_id` (主键)
- `contact` (联系电话)
- `gender` (性别)
- `consignee` (收货人)
- `province` (省份)
- `city` (城市)
- `district` (区县)
- `detail_address` (详细地址)
- `is_default` (是否默认地址: 0否, 1是)
- `user_id` (所属用户ID, 逻辑外键)
- **注意事项**：一个用户可以有多条地址记录，但只能有一个默认地址。

#### 4.2.7 `tb_cart_item` (购物车项表)

- `cart_item_id` (主键)
- `product_name` (产品名称, 冗余)
- `product_main_url` (产品主图URL, 冗余)
- `quantity` (产品数量)
- `product_price` (产品单价快照)
- `is_selected` (是否选中: 0未选中, 1选中)
- `product_id` (产品ID, 逻辑外键)
- `user_id` (用户ID, 逻辑外键)

#### 4.2.8 `tb_order` (订单表)

- `order_id` (主键)
- `order_code` (订单编码, 唯一)
- `parent_order_code` (父订单号, 用于关联跨店铺购物产生的子订单)
- `order_status` (订单状态: 1待发货, 2待收货, 3待评价, 4已完成, 5已删除, 6已取消)
- `total_amount` (订单总额)
- `province_snapshot`, `city_snapshot`, `district_snapshot`, `detail_address_snapshot` (收货地址快照)
- `receiver_snapshot` (收货人快照)
- `contact_snapshot` (联系电话快照)
- `order_remark` (订单备注)
- `address_id` (关联的地址簿ID, 逻辑外键)
- `user_id` (下单用户ID, 逻辑外键)
- `store_id` (所属店铺ID, 逻辑外键)
- **注意事项**：一笔订单只能对应一个店铺；跨店铺购物时，会生成一个父订单号关联多个子订单。

#### 4.2.9 `tb_order_detail` (订单详情表)

- `order_detail_id` (主键)
- `product_name_snapshot` (产品名称快照)
- `product_main_url_snapshot` (产品主图URL快照)
- `quantity` (产品数量)
- `product_price_snapshot` (产品单价快照)
- `total_amount` (该项商品总额)
- `price_unit_snapshot` (产品规格/计价单位快照)
- `order_id` (所属订单ID, 逻辑外键)
- `product_id_snapshot` (产品ID快照, 即使原产品被删除，此处信息保留)

#### 4.2.10 `tb_file` (文件表)

- `file_id` (主键)
- `biz_type` (业务类型, 如: user_avatar, store_logo, product_image, review_image)
- `biz_id` (业务ID, 对应各业务表主键)
- `storage_path` (文件存储完整路径或URL)
- `is_main_image` (是否主图标记, 主要用于产品多图场景)
- **注意事项**：统一管理系统中的图片等文件资源。

#### 4.2.11 `tb_favorite` (收藏表)

- `favorite_id` (主键)
- `user_id` (用户ID, 逻辑外键)
- `product_id` (产品ID, 逻辑外键)
- **注意事项**：`user_id` 和 `product_id` 构成联合唯一约束。

#### 4.2.12 `tb_review` (评价表)

- `review_id` (主键)
- `content` (评价内容)
- `rating` (评价等级)
- `is_anonymous` (是否匿名: 0不匿名, 1匿名)
- `user_id` (评价用户ID, 逻辑外键)
- `order_id` (关联的订单ID, 逻辑外键)
- `product_id` (评价的商品ID，逻辑外键)
- **注意事项**：用户购买商品后才能对该订单中的商品进行评价。评价图片信息存储在 `tb_file` 表中，通过 `biz_type='review_image'` 和 `biz_id=review_id` 关联。

### 4.3 冗余字段说明

为提高查询效率和简化业务逻辑，部分表中设计了冗余字段，如：

- `tb_product` 中的 `store_name`。
- `tb_cart_item` 中的 `product_name`, `product_main_url`。
- `tb_product` 中的 `main_img` (作为主图URL)。
- `tb_store` 中的 `store_logo`。

这些冗余字段的数据一致性通过在业务逻辑层面进行同步更新来保证。

## 5. 核心业务逻辑

### 5.1 商品计价逻辑

当客户下单购买商品时，系统会根据商家在 `tb_product` 表中为该商品设置的 `price` (价格) 和 `price_unit` (计价单位)，结合客户购买的数量（可能涉及 `specification_value` 和 `specification_unit` 的转换），计算出订单中该商品项的总金额。例如，若商品A价格为15.8元/斤，客户下单2.3斤，则该商品项金额为 2.3 × 15.8 = 36.34元。交易完成后，对应商品的库存 (`stock`) 会实时扣减。

### 5.2 订单拆分逻辑

当用户在购物车中选择了分属于不同店铺的多个商品并进行结算时，系统会自动按店铺进行订单拆分。 具体流程如下：

1. 用户点击结算后，系统遍历购物车中所有选中的商品。
2. 根据每个商品所属的 `store_id` 进行分组。
3. 为每个 `store_id` 生成一个独立的子订单（`tb_order`记录）。
4. 如果一次结算涉及多个店铺，系统会生成一个唯一的 `parent_order_code`，并将此代码赋给所有因此次结算产生的子订单。如果只涉及一个店铺，则 `parent_order_code` 为空。
5. 每个子订单中包含对应店铺的商品项，这些商品项记录在 `tb_order_detail` 表中，并关联到相应的子订单。 这样，买家可以在“我的订单”中查看到按父订单号聚合的购物记录，而卖家则只处理自己店铺相关的子订单。